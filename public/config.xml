<Sysmon schemaversion="4.90">
  <!-- Capture all hashes -->
  <HashAlgorithms>*</HashAlgorithms>
  <EventFiltering>
	<RuleGroup name="MY_Process_Creation" groupRelation="or">
	  <ProcessCreate onmatch="exclude">
	  	<CommandLine condition="is">C:\Windows\system32\svchost.exe -k appmodel -s StateRepository</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k appmodel</CommandLine>				<!--Microsoft:Windows 10-->
		<CommandLine condition="is">C:\WINDOWS\system32\svchost.exe -k appmodel -p -s tiledatamodelsvc</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k camera -s FrameServer</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k dcomlaunch -s LSM</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k dcomlaunch -s PlugPlay</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k defragsvc</CommandLine>				<!--Microsoft:Windows defragmentation-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k devicesflow -s DevicesFlowUserSvc</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k imgsvc</CommandLine>				<!--Microsoft:The Windows Image Acquisition Service-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localService -s EventSystem</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localService -s bthserv</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localService -s nsi</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localService -s w32Time</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localServiceAndNoImpersonation</CommandLine>				<!--Microsoft:Windows: Network services-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted -s Dhcp</CommandLine>				<!--Microsoft:Windows: Network services-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted -s EventLog</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted -s TimeBrokerSvc</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted -s WFDSConMgrSvc</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted</CommandLine>				<!--Microsoft:Windows: Network services-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localServiceAndNoImpersonation -s SensrSvc</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localServiceNoNetwork</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -p -s WPDBusEnum</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -p -s fhsvc</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s DeviceAssociationService</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s NcbService</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s SensorService</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s TabletInputService</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s UmRdpService</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s WPDBusEnum</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s WdiSystemHost</CommandLine>				<!--Microsoft:Windows: Diagnostic System Host [ http://www.blackviper.com/windows-services/diagnostic-system-host/ ] -->
		<CommandLine condition="is">C:\WINDOWS\System32\svchost.exe -k LocalSystemNetworkRestricted -p -s WdiSystemHost</CommandLine>				<!--Microsoft:Windows: Diagnostic System Host [ http://www.blackviper.com/windows-services/diagnostic-system-host/ ] -->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted</CommandLine>				<!--Microsoft:Windows-->
		<CommandLine condition="is">C:\WINDOWS\system32\svchost.exe -k netsvcs -p -s wlidsvc</CommandLine>				<!--Microsoft:Windows: Windows Live Sign-In Assistant [ https://www.howtogeek.com/howto/30348/what-are-wlidsvc.exe-and-wlidsvcm.exe-and-why-are-they-running/ ] -->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -p -s ncaSvc</CommandLine>				<!--Microsoft:Windows: Network Connectivity Assistant [ http://www.blackviper.com/windows-services/network-connectivity-assistant/ ] -->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s BDESVC</CommandLine>				<!--Microsoft:Windows:Network: BitLocker Drive Encryption-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s BITS</CommandLine>				<!--Microsoft:Windows:Network: Background Intelligent File Transfer (BITS) -->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s CertPropSvc</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s DsmSvc</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s Gpsvc</CommandLine>				<!--Microsoft:Windows:Network: Group Policy -->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s ProfSvc</CommandLine>				<!--Microsoft:Windows: Network services-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s SENS</CommandLine>				<!--Microsoft:Windows: Network services-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s SessionEnv</CommandLine>				<!--Microsoft:Windows: Network services-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s Themes</CommandLine>				<!--Microsoft:Windows: Network services-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs -s Winmgmt</CommandLine>				<!--Microsoft:Windows: Windows Management Instrumentation (WMI) -->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs</CommandLine>				<!--Microsoft:Windows: Network services-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k networkService -p -s DoSvc</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k networkService -s Dnscache</CommandLine>				<!--Microsoft:Windows:Network: DNS caching, other uses -->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k networkService -s LanmanWorkstation</CommandLine>				<!--Microsoft:Windows:Network: "Workstation" service, used for SMB file-sharing connections and RDP-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k networkService -s NlaSvc</CommandLine>				<!--Microsoft:Windows:Network: Network Location Awareness-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k networkService -s TermService</CommandLine>				<!--Microsoft:Windows:Network: Terminal Services (RDP)-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k networkService</CommandLine>				<!--Microsoft:Windows: Network services-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k networkServiceNetworkRestricted</CommandLine>				<!--Microsoft:Windows: Network services-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k rPCSS</CommandLine>				<!--Microsoft:Windows Services-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k secsvcs</CommandLine>
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k swprv</CommandLine>				<!--Microsoft:Software Shadow Copy Provider-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k unistackSvcGroup</CommandLine>				<!--Microsoft:Windows 10-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k utcsvc</CommandLine>				<!--Microsoft:Windows Services-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k wbioSvcGroup</CommandLine>				<!--Microsoft:Windows Services-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k werSvcGroup</CommandLine>				<!--Microsoft:Windows: ErrorReporting-->
		<CommandLine condition="is">C:\WINDOWS\System32\svchost.exe -k wsappx -p -s ClipSVC</CommandLine>				<!--Microsoft:Windows:Apps: Client License Service-->
		<CommandLine condition="is">C:\WINDOWS\system32\svchost.exe -k wsappx -p -s AppXSvc</CommandLine>				<!--Microsoft:Windows:Apps: AppX Deployment Service-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k wsappx -s ClipSVC</CommandLine>				<!--Microsoft:Windows:Apps: Client License Service-->
		<CommandLine condition="is">C:\Windows\system32\svchost.exe -k wsappx</CommandLine>				<!--Microsoft:Windows:Apps [ https://www.howtogeek.com/320261/what-is-wsappx-and-why-is-it-running-on-my-pc/ ] -->
		<ParentCommandLine condition="is">C:\Windows\system32\svchost.exe -k netsvcs</ParentCommandLine>				<!--Microsoft:Windows: Network services: Spawns Consent.exe-->
		<ParentCommandLine condition="is">C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted</ParentCommandLine>				<!--Microsoft:Windows-->
	  </ProcessCreate>
	</RuleGroup>

	<RuleGroup name="NetworkConnect" groupRelation="or">
		<!-- ID:3 NetworkConnect -->
		<NetworkConnect onmatch="exclude">
			<Image condition="end with">iexplore.exe</Image>
			<Image condition="end with">svchost.exe</Image>
			<!-- <Image condition="end with">powershell.exe</Image> -->
		</NetworkConnect>
	</RuleGroup>

	<RuleGroup name="ProcessTermination" groupRelation="or">
		<!-- ID:5 Process termination -->
		<ProcessTerminate onmatch="exclude">
		</ProcessTerminate>
	</RuleGroup>

	<RuleGroup name="CreateRemoteThread" groupRelation="or">
		<!-- ID:8 CreateRemoteThread -->
		<CreateRemoteThread onmatch="exclude">
		</CreateRemoteThread>
	</RuleGroup>

	<RuleGroup name="RawAccessRead" groupRelation="or">
		<!-- ID:9 RawAccessRead -->
		<RawAccessRead onmatch="exclude">
		</RawAccessRead>
	</RuleGroup>

	<RuleGroup name="FileCreation" groupRelation="or">
		<!-- ID:11 FileCreate -->
		<FileCreate onmatch="exclude">
		</FileCreate>
	</RuleGroup>

	<RuleGroup name="registryEvent" groupRelation="or">
		<!-- ID: 12 Registry object added or deleted -->
		<RegistryEvent onmatch="exclude">
		<Image condition="begin with">C:\WINDOWS\system32</Image>
		<Image condition="end with">svchost.exe</Image>
		<Image condition="end with">powershell.exe</Image>
		<Image condition="end with">Explorer.exe</Image>
		<Image condition="end with">MsMpEng.exe</Image>
		<Image condition="end with">srtask.exe</Image>
		<Image condition="end with">autorunsc64.exe</Image>
		<Image condition="end with">sihost.exe</Image>
		<Image condition="end with">lsass.exe</Image>
		<Image condition="end with">wmiprvse.exe</Image>
		</RegistryEvent>
	</RuleGroup>

	<RuleGroup name="WMIEVENT" groupRelation="or">
		<!-- ID:19 WmiEvent -->
		<WmiEvent onmatch="exclude">
		</WmiEvent>
	</RuleGroup>

	<RuleGroup name="PIPE_EVENT" groupRelation="or">
		<PipeEvent onmatch="exclude">
		</PipeEvent>
	</RuleGroup>

	<RuleGroup name="DNS_QUERY" groupRelation="or">
		<!-- ID:22 DNSQuery -->
		<DnsQuery onmatch="exclude">
		<Image condition="end with">Sysmon64.exe</Image>
		<Image condition="end with">svchost.exe</Image>
		</DnsQuery>
	</RuleGroup>

	<RuleGroup name="File_DELETED_DETECTED" groupRelation="or">
		<!-- ID:26 HOW to detected delete file by use mouse-->
		<FileDeleteDetected onmatch="include">
		<TargetFilename condition="not end with">psm1</TargetFilename>
		<TargetFilename condition="not begin with">C:\Windows\Temp\__</TargetFilename>
		<!-- <Image condition="end with">powershell.exe</Image> -->
		<Image condition="end with">cmd.exe</Image>
		<Image condition="end with">Explorer.EXE</Image>
		</FileDeleteDetected>
	
	</RuleGroup>

	<!-- if not disable ,exe file can't create. -->
	<!-- ID:27 For Rust build a file to execute files and chrome download a exec file..-->
	<!-- <FileBlockExecutable onmatch="exclude">
	<Image condition="end with">powershell.exe</Image>
	<Image condition="end with">chrome.exe</Image>
	<Image condition="end with">Explorer.exe</Image>
	</FileBlockExecutable> -->

	<RuleGroup name="File_EXCUTEABLE_DETECTED" groupRelation="and">
		<!-- ID:29 -->
		<FileExecutableDetected onmatch="exclude">

		</FileExecutableDetected>
	
	</RuleGroup>
  </EventFiltering>
</Sysmon>